<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <title>Test Camera</title>
  <script src="../dist/bundle.js"></script>
</head>
<body>
  <button id="askPerm">Click me to ask for permission!</button>
</body>
<script>
  var Eyetracker = eyetrack.initEyetracker();

  const btn = document.getElementById("askPerm");
  btn.addEventListener("click", askPermission);

  async function askPermission() {
    await Eyetracker.init();
    await Eyetracker.getCameraPermission();
    const btn = document.getElementById("askPerm");
    btn.remove();
    updateCameraSelect();
  }

  async function updateCameraSelect() {
    const devices = await Eyetracker.getListOfCameras();
    console.log(devices[0]);
    const selector = document.createElement("select");
    selector.id = "cameraList";
    selector.name = "cameras";

    const blank = document.createElement("option");
    blank.style.display = "none";
    selector.appendChild(blank);

    devices.forEach((d) => {
      let op = document.createElement("option");
      op.value = d.deviceId;
      op.innerHTML = d.label;

      selector.appendChild(op);
    });
    document.body.innerHTML = `
    <p>Please select the camera you'd like to use.</p>
    `;
    document.body.appendChild(selector);

    const btnSelect = document.createElement("button");
    btnSelect.id = "btnSelect";
    btnSelect.innerHTML = "SELECT";
    btnSelect.addEventListener("click", startDetection);
    document.body.appendChild(btnSelect);
  }

  async function startDetection() {
    const selector = document.getElementById("cameraList");
    const id = selector.options[selector.selectedIndex].value;
    await Eyetracker.setCamera(
      await navigator.mediaDevices.getUserMedia({ video: { deviceId: id } })
    );
    await Eyetracker.createVideo("test video");
    await Eyetracker.createDisplay("test canvas");
    Eyetracker.keypointsAnimation(true);
  }

  askPermission;
</script>
